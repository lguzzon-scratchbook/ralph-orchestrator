# Ralph Orchestrator Configuration - Code Assist
# v2 nested format - TDD-based implementation following code-assist SOP
# See: .sops/code-assist.sop.md for full workflow documentation

# Event loop settings
event_loop:
  completion_promise: "LOOP_COMPLETE"
  max_iterations: 100
  max_runtime_seconds: 28800      # 8 hours
  idle_timeout_secs: 1800

# CLI backend settings
cli:
  backend: "claude"
  prompt_mode: "arg"              # Pass prompt as CLI argument

# Core behaviors (always injected into prompts)
core:
  specs_dir: "./specs/"
  guardrails:
    - "Fresh context each iteration - save learnings to memories for next time"
    - "Don't assume 'not implemented' - search first"
    - "Backpressure is law - tests/typecheck/lint must pass"

hats:
  builder:
    name: "Code Assist Builder"
    description: "TDD-based implementation: Explore, Plan, Code, Commit."
    triggers: ["build.task", "task.start"]
    publishes: ["build.done", "build.blocked"]
    instructions: |
      # Code Assist Builder Hat

      Read and follow the SOP at: .sops/code-assist.sop.md

      This SOP defines a TDD-based workflow: Explore → Plan → Code → Commit

      ## Event Publishing (CRITICAL)
      You MUST publish events using `ralph emit`. Ralph parses these from JSONL.

      When task is complete with passing tests:
      ```bash
      ralph emit "build.done" "tests: pass. Summary of what was implemented"
      ```

      When blocked and unable to proceed:
      ```bash
      ralph emit "build.blocked" "Explanation of what's blocking progress"
      ```
      If the plan has already been created, work on a single, highest priority single, atomic task.
